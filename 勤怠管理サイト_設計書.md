# 勤怠管理サイト 設計書（サーブレット / JSP）

<aside>
📎

**もくじ**

</aside>

---

## 1. システム概要

### 1-1. 目的

学生やバイトなどの「出勤時間・退勤時間」を、Web 上で簡単に記録・閲覧できる勤怠管理サイトを作る。

- ブラウザから「出勤」「退勤」ボタンを押すだけで記録できる
- 各自が自分の月ごとの勤怠履歴を一覧で確認できる

**やらないこと（スコープ外）**

- 残業計算・給与計算までは行わない
- シフト管理、高度な集計（グラフ表示など）は行わない
→ ここまでやると初心者には重すぎるので、**「出勤 / 退勤を記録して、履歴を一覧で見られる」までに絞る。**

---

## 2. 想定ユーザーとユースケース

### 2-1. 想定ユーザー

- 一般ユーザー（学生など）
    - 自分用のアカウントを作成
    - 毎日、出勤・退勤を記録
    - 自分の勤怠履歴を月単位で確認

※ 管理者ユーザー（先生など）の機能は、今回は「拡張機能」として後述。

### 2-2. ユースケース（やることの流れ）

1. 新規ユーザー登録をする（ユーザー名、ログインID、パスワード）
2. ログインする
3. 今日の「出勤」ボタンを押す
4. 帰るときに「退勤」ボタンを押す
5. 「勤怠一覧」画面で、自分の当月の出勤・退勤時刻が一覧で見られる

---

## 3. 画面設計（ワイヤーフレーム）

### 3-1. 画面一覧

1. ログイン画面
2. 新規登録画面
3. 勤怠打刻画面（出勤・退勤ボタン）
4. 勤怠一覧画面

---

### 3-2. ログイン画面（`login.jsp`）

- URL: `/login` (GET で表示、POST でログイン処理)

**項目**

- ログインID（テキスト）
- パスワード（パスワード）
- 「ログイン」ボタン
- 「新規登録はこちら」リンク

<aside>

**イメージ**

[ログインID ][ ]
[パスワード ][ ]

[ ログイン ]

</aside>

---

### 3-3. 新規登録画面（`register.jsp`）

- URL: `/register`

**項目**

- ユーザー名
- ログインID
- パスワード
- パスワード（確認用でも可・省略も可）
- 「登録」ボタン

---

### 3-4. 勤怠打刻画面（`attendance.jsp`）

- URL: `/attendance`
- ログイン済ユーザーのみアクセス可能

**表示内容**

- ログイン中ユーザー名
- 今日の日付
- 今日の出勤時刻 / 退勤時刻（打刻済みなら表示）
- 出勤ボタン（未出勤のときのみ有効）
- 退勤ボタン（出勤済み・退勤未済みのときのみ有効）
- 「今月の勤怠一覧」へのリンク
- 「ログアウト」リンク

<aside>

**イメージ**

今日の日付: 2025-11-18

出勤時刻: 09:01
退勤時刻: --:--

[ 出勤 ]  ← まだ出勤していない時だけ押せる
[ 退勤 ]  ← 出勤済み & 退勤していない時に押せる

[ 今月の勤怠一覧を見る ]

[ ログアウト ]

</aside>

---

### 3-5. 勤怠一覧画面（`attendance_list.jsp`）

- URL: `/attendance/list`
- パラメータ：year, month（なければ現在の年月）

**表示内容**

- ログインユーザー名
- 「YYYY年MM月の勤怠一覧」
- 日付ごとの出勤・退勤時刻一覧（テーブル）
- 合計日数（出勤した日数）

<aside>

**イメージ**

[ 前の月 ]        2025年11月        [ 次の月 ]

+------------+----------+----------+

| 日付       | 出勤時刻 | 退勤時刻 |

+------------+----------+----------+

| 2025-11-01 | 09:00    | 18:00    |
| 2025-11-02 | 09:05    | 18:10    |
| ...        | ...      | ...      |

+------------+----------+----------+

出勤日数: 20 日

[ 打刻画面に戻る ]
[ ログアウト ]

</aside>

---

## 4. 機能一覧

### 4-1. 必須機能

1. ユーザー登録
2. ログイン / ログアウト
3. 出勤打刻（その日の最初の打刻）
4. 退勤打刻（その日の最後の打刻）
5. 自分の勤怠一覧（年月指定）表示

### 4-2. 余裕があれば追加する機能（拡張）

- 同じ日に2回以上出勤ボタンを押せないようにする
- 退勤がまだなのに次の日になった場合の扱い（※複雑になるので最初は無視して OK）
- 管理者ユーザーが全員分の勤怠を見られる画面

**最初から全部やろうとするのは危険なので、上の「必須機能」だけ確実に完成させること。**

---

## 5. URL・サーブレット設計

### 5-1. URL 一覧

| URL | HTTPメソッド | 処理内容 | 対応サーブレット | 表示JSP |
| --- | --- | --- | --- | --- |
| `/login` | GET | ログイン画面表示 | `LoginServlet` | `login.jsp` |
| `/login` | POST | ログイン処理 | `LoginServlet` | 成功→リダイレクト `/attendance` |
| `/logout` | GET | ログアウト（セッション破棄） | `LogoutServlet` | リダイレクト `/login` |
| `/register` | GET | 新規登録画面表示 | `RegisterServlet` | `register.jsp` |
| `/register` | POST | 新規登録処理 | `RegisterServlet` | 成功→`login.jsp` など |
| `/attendance` | GET | 今日の打刻状態表示 | `AttendanceServlet` | `attendance.jsp` |
| `/attendance` | POST | 出勤 or 退勤ボタン処理 | `AttendanceServlet` | 処理後→リダイレクト `/attendance` |
| `/attendance/list` | GET | 勤怠一覧表示（年月指定） | `AttendanceListServlet` | `attendance_list.jsp` |

---

## 6. データベース設計

### 6-1. ER 図（文章バージョン）

- `users`（ユーザー） 1 —— N `attendance`（勤怠）

1人のユーザーに対して、複数の勤怠レコード（1日1レコード）を持つ。

---

### 6-2. テーブル定義

### ① users テーブル（ユーザー情報）

| カラム名 | 型 | NOT NULL | 主キー | 説明 |
| --- | --- | --- | --- | --- |
| id | INT | YES | YES | ユーザーID（AUTO_INCREMENT） |
| login_id | VARCHAR(50) | YES | UNIQUE | ログイン用ID（重複不可） |
| password_hash | VARCHAR(255) | YES |  | パスワード（ハッシュ化推奨） |
| name | VARCHAR(100) | YES |  | 表示名（山田太郎など） |
| created_at | DATETIME | YES |  | 登録日時 |

※パスワードを平文で保存するのは本当はダメ。課題では最悪プレーンでもいいが、**本来はハッシュ化するべき**。

---

### ② attendance テーブル（勤怠情報）

| カラム名 | 型 | NOT NULL | 主キー | 説明 |
| --- | --- | --- | --- | --- |
| id | INT | YES | YES | 勤怠ID（AUTO_INCREMENT） |
| user_id | INT | YES | FK | [users.id](http://users.id/) への外部キー |
| work_date | DATE | YES |  | 勤務日（2025-11-18 など） |
| start_time | TIME | NO |  | 出勤時刻（NULL = 未打刻） |
| end_time | TIME | NO |  | 退勤時刻（NULL = 未打刻） |
| created_at | DATETIME | YES |  | レコード作成日時 |
| updated_at | DATETIME | YES |  | 最終更新日時 |

**ルール**

- 1ユーザー + 1日につき、レコードは原則1件
- 出勤打刻時：
    - work_date = 今日
    - start_time に現在時刻を保存
    - その日のレコードがまだなければ INSERT
- 退勤打刻時：
    - 同じ work_date のレコードに対して end_time を UPDATE

---

## 7. クラス設計（簡易）

### 7-1. モデルクラス

### `model.User`

- フィールド
    - int id
    - String loginId
    - String passwordHash
    - String name

### `model.Attendance`

- フィールド
    - int id
    - int userId
    - LocalDate workDate
    - LocalTime startTime
    - LocalTime endTime
    
    ---
    
    ### 7-2. DAO クラス（DBアクセス）
    
    ### `dao.UserDAO`
    
    - `User findByLoginIdAndPassword(String loginId, String password)`
        - ログイン時に使用（課題ではパスワード平文でも可）
    - `boolean insert(User user)`
        - 新規登録用
    
    ### `dao.AttendanceDAO`
    
    - `Attendance findByUserIdAndDate(int userId, LocalDate date)`
    - `boolean insert(Attendance attendance)`
    - `boolean update(Attendance attendance)`
    - `List<Attendance> findByUserIdAndMonth(int userId, int year, int month)`
    
    ---
    
    ### 7-3. サーブレットクラス
    
    - `LoginServlet`
    - `LogoutServlet`
    - `RegisterServlet`
    - `AttendanceServlet`
    - `AttendanceListServlet`

---

## 8. 処理の流れ（予定）

### 8-1. ログインの流れ

1. ユーザーが `/login` にアクセス（GET）
2. `LoginServlet` が `login.jsp` を表示
3. フォーム送信（POST）
4. `LoginServlet#doPost`
    - `request.getParameter("loginId")`
    - `request.getParameter("password")`
    - `UserDAO.findByLoginIdAndPassword(...)` で検索
    - 見つかったら `HttpSession` にユーザー情報を保存
    - `/attendance` にリダイレクト
    - 見つからなかったら `login.jsp` にエラーメッセージ付きで戻す

---

### 8-2. 出勤打刻の流れ

1. `/attendance` にアクセス（GET）
    - ログイン済みかチェック（セッションにユーザーがいなければ `/login` にリダイレクト）
    - 今日の `Attendance` を取得して画面に渡す
2. 出勤ボタン押下（POST、`action=start` などのパラメータで判別）
3. `AttendanceServlet#doPost`
    - `userId` と今日の日付からレコードを検索
    - なければ新規 `Attendance` を作成し、`start_time` に現在時刻で INSERT
    - あれば `start_time` を上書きするか、エラーにする（仕様次第。簡単のため上書きでも良い）
    - 処理後 `/attendance` にリダイレクト

---

### 8-3. 退勤打刻の流れ

1. `/attendance` から退勤ボタン押下（POST、`action=end`）
2. `AttendanceServlet#doPost`
    - その日の `Attendance` を取得
    - `end_time` に現在時刻をセットし UPDATE
    - 処理後 `/attendance` にリダイレクト

---

### 8-4. 勤怠一覧表示の流れ

1. `/attendance/list?year=2025&month=11` にアクセス（GET）
2. `AttendanceListServlet`
    - パラメータがなければ現在の年月を使用
    - `AttendanceDAO.findByUserIdAndMonth(...)` で一覧取得
    - リストをリクエスト属性にセットし `attendance_list.jsp` へフォワード

---

## 9. 役割分担案（グループ向け）

### 9-1. メンバーA：画面担当（HTML / JSP）

- `login.jsp` / `register.jsp` / `attendance.jsp` / `attendance_list.jsp` の HTML を作る
- デザインはシンプルで OK（テーブルとフォーム程度）

### 9-2. メンバーB：CSS・見た目担当

- 共通レイアウト（ヘッダー・フッター）
- テーブルやボタンの見た目調整

### 9-3. メンバーC：DB・SQL担当

- MySQL などで `users` / `attendance` テーブルを作成
- 動作確認用のダミーユーザーを作る
- 必要なら SQL ファイルを用意（`create_tables.sql` など）

### 9-4. メンバーD：サーブレット・DAO・全体設計

- この設計書の作成
- `UserDAO` / `AttendanceDAO` / Servlet クラスの実装
- ログイン管理（セッション）
- 最後の統合作業・バグ修正

**ダメな分担の例**

- 「全員でサーブレットをバラバラに書く」
→ コードが衝突して大事故になる
- 「各自好きな機能を自由に作る」
→ 仕様がバラバラで統合不能

なので、**「骨組み」と「ルール」を決めて、みんなはその枠の中で作業する形が安全。**

---

## 10. プロジェクト構成（予想）

```
src/
 └─ servlet/
      ├─ LoginServlet.java
      ├─ LogoutServlet.java
      ├─ RegisterServlet.java
      ├─ AttendanceServlet.java
      └─ AttendanceListServlet.java
 └─ model/
      ├─ User.java
      └─ Attendance.java
 └─ dao/
      ├─ UserDAO.java
      └─ AttendanceDAO.java

WebContent/
 ├─ WEB-INF/
 │    ├─ index.jsp
 │    └─ jsp/
 │         ├─ login.jsp
 │         ├─ register.jsp
 │         ├─ attendance.jsp
 │         └─ attendance_list.jsp
 └─ css/
      └─ style.css

```